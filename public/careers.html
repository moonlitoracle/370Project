<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Careers - CareerRoadmap</title>
    <link rel="stylesheet" href="css/style.css">

</head>

<body>
    <header>
        <nav>
            <div class="logo">CareerRoadmap</div>
            <ul>
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="careers.html">Careers</a></li>
                <li><a href="goals.html">Goals</a></li>
                <li><a href="skill-management.html">Skills</a></li>
                <li><a href="skill-gap-analysis.html">Gap Analysis</a></li>
                <li><a href="progress-tracking.html">Progress</a></li>
                <li><a href="resources.html">Resources</a></li>
                <li><a href="#" id="logoutBtn" class="btn btn-secondary">Logout</a></li>
            </ul>
        </nav>
    </header>

    <main class="careers-container">
        <h1>Explore Career Paths ðŸš€</h1>

        <section>
            <h2>Available Careers</h2>
            <div id="careersList" class="careers-grid"></div>
        </section>

        <!-- Career Details Modal -->
        <div id="careerModal" class="modal" style="display: none;">
            <div class="modal-backdrop" onclick="closeCareerModal()"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="careerName"></h2>
                    <button class="modal-close" onclick="closeCareerModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="careerOverview"></p>
                    <h3>Required Skills</h3>
                    <div id="requiredSkills"></div>
                </div>
                <div class="modal-footer">
                    <button id="selectCareerBtn" class="btn btn-primary">Select This Career</button>
                    <button class="btn btn-secondary" onclick="closeCareerModal()">Close</button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 CareerRoadmap. Empowering careers, one skill at a time.</p>
    </footer>

    <script src="js/app.js"></script>
    <script>
        let selectedCareerId = null;

        // Check authentication
        async function checkAuth() {
            const result = await Auth.checkSession();
            if (result.status !== 'success') {
                UI.redirect('login.html');
                return false;
            }
            return true;
        }

        // Load careers list
        async function loadCareers() {
            const result = await Career.list();
            if (result.status === 'success') {
                const careersList = document.getElementById('careersList');
                careersList.innerHTML = '';

                result.data.forEach(career => {
                    const careerCard = document.createElement('div');
                    careerCard.className = 'career-card';
                    const isSelected = career.is_selected == 1;
                    const badgeHtml = isSelected ? '<span class="badge-selected">Selected</span>' : '';
                    const btnHtml = isSelected
                        ? `<button class="btn btn-outline" onclick="viewCareerDetails(${career.career_id})">View Details</button>`
                        : `<button class="btn btn-primary" onclick="viewCareerDetails(${career.career_id})">View Details</button>`;

                    careerCard.innerHTML = `
                        <div style="display:flex; justify-content:space-between; align-items:start;">
                            <h3>${career.name}</h3>
                            ${badgeHtml}
                        </div>
                        <p>${career.overview || 'No description available'}</p>
                        ${btnHtml}
                    `;
                    careersList.appendChild(careerCard);
                });
            }
        }

        // View career details
        window.viewCareerDetails = async (careerId) => {
            console.log('View Details clicked for career ID:', careerId);

            try {
                const result = await Career.getDetails(careerId);
                console.log('API Result:', result);

                if (result.status === 'success') {
                    selectedCareerId = careerId;
                    const career = result.data;

                    document.getElementById('careerName').textContent = career.name;
                    document.getElementById('careerOverview').textContent = career.overview || 'No description available';

                    const skillsList = document.getElementById('requiredSkills');
                    skillsList.innerHTML = '';

                    if (career.required_skills && career.required_skills.length > 0) {
                        career.required_skills.forEach(skill => {
                            const skillTag = document.createElement('span');
                            skillTag.className = 'skill-tag';
                            skillTag.textContent = `${skill.name} (${skill.level})`;
                            skillsList.appendChild(skillTag);
                        });
                    } else {
                        skillsList.innerHTML = '<p>No specific skills required</p>';
                    }

                    const selectBtn = document.getElementById('selectCareerBtn');
                    if (career.is_selected) {
                        selectBtn.textContent = 'Already Selected';
                        selectBtn.disabled = true;
                        selectBtn.classList.add('btn-secondary');
                        selectBtn.classList.remove('btn-primary');
                    } else {
                        selectBtn.textContent = 'Select This Career';
                        selectBtn.disabled = false;
                        selectBtn.classList.add('btn-primary');
                        selectBtn.classList.remove('btn-secondary');
                    }

                    document.getElementById('careerModal').style.display = 'flex';
                    // Prevent body scroll when modal is open
                    document.body.style.overflow = 'hidden';
                } else {
                    console.error('API Error:', result.message);
                    alert('Error: ' + result.message);
                }
            } catch (error) {
                console.error('Failed to load career details:', error);
                alert('Failed to load career details. Check console for details.');
            }
        };

        // Close career modal
        window.closeCareerModal = () => {
            document.getElementById('careerModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        };

        // Select career
        document.getElementById('selectCareerBtn').addEventListener('click', async () => {
            if (!selectedCareerId) return;

            const result = await Career.select(selectedCareerId);
            if (result.status === 'success') {
                UI.showMessage('Career selected successfully! Refreshing...', 'success');
                setTimeout(() => window.location.reload(), 1500);
            } else {
                UI.showMessage(result.message, 'error');
            }
        });

        // Logout handler
        document.getElementById('logoutBtn').addEventListener('click', async (e) => {
            e.preventDefault();
            const result = await Auth.logout();
            if (result.status === 'success') {
                UI.clearCurrentUser();
                UI.redirect('index.html');
            }
        });

        // Initialize
        (async () => {
            if (await checkAuth()) {
                await loadCareers();
            }
        })();
    </script>
</body>

</html>